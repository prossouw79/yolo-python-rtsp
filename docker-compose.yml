version: "3.3"
services:
  rtsp-yolo-python-cam1:
    image: pietersynthesis/nvidia-yolo-rtsp-python
    build: .
    volumes: 
     - "./output:/app/output"
    command: python3 yolo_opencv.py --quiet ${CAM1_QUIET} --input ${CAM1_STREAM} --invertcolor ${CAM1_INVERT_COLOR} --fpsthrottle ${CAM1_FPS_THROTTLE} --minwidth ${CAM1_MIN_WIDTH}
    restart: unless-stopped
    deploy:
        resources:
            limits:
              cpus: '2'
              memory: 512M

  rtsp-yolo-python-cam2:
    image: pietersynthesis/nvidia-yolo-rtsp-python
    build: .
    volumes: 
    - "./output:/app/output"
    command: python3 yolo_opencv.py --quiet ${CAM2_QUIET} --input ${CAM2_STREAM} --invertcolor ${CAM2_INVERT_COLOR} --fpsthrottle ${CAM2_FPS_THROTTLE} --minwidth ${CAM2_MIN_WIDTH}
    restart: unless-stopped
    deploy:
        resources:
            limits:
              cpus: '1'
              memory: 512M

  node-red:
    image: nodered/node-red:latest
    environment:
      - TZ=Africa/Johannesburg
      - PORT=1880
    network_mode: host
    volumes:
      - ./node-red-data:/data
      - ./output:/detected
    restart: unless-stopped
    depends_on:
      - rtsp-yolo-python-cam1